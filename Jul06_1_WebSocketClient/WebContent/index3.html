<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" href="https://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" />
<script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
<script src="https://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
<script type="text/javascript" src="http://192.168.0.127:1313/socket.io/socket.io.js"></script>
<script type="text/javascript">

	// HTML5 캔버스
	// jQuery 이벤트처리
	// Node.js socket.io 웹소켓서버
	
	// workspace에서 cmd
	// npm install -g express-generator : Express Generator를 전역으로 설치안되어 있을때
	// express 프로젝트 만들고 : express 프로젝트명
	// npm install : 프로젝트 종속성 설치
	// npm install socket.io@2 : socket.io 설치
	// nodemon app.js

	
	$(function() {
		var socket = io.connect("http://192.168.0.127:1313");
		var n;
		$("#msg").keyup(function(e){
			if (e.keyCode == 13) {
				n = $("#nickname").val();		
				var m = $(this).val();
				var msg = { nn : n, txt : m };
				socket.emit("clientMsg", msg);	
				$(this).val("");
			}
		});
		
		socket.on("serverMsg", function(m) {
			var br = $("<br>");	
			var br2 = $("<br>");
			var who = "[" + m.nn + "]";
			var td1 = $("<td></td>").append(who, br, br2, m.txt);
			var td2 = $("<td></td>").attr("style", "width:20%;");
			var td3 = $("<td></td>").attr("style", "width:40%;");
			var tr;
			if (n == m.nn) {
				td1 = $(td1).attr("class", "myMsg").attr("align", "right");
				tr = $("<tr></tr>").append(td3, td2, td1);
			} else {
				td1 = $(td1).attr("class", "yourMsg");
				tr = $("<tr></tr>").append(td1, td2, td3);
			}
			$("table").append(tr);
			var htmlHeight = $(document).height();
			$(window).scrollTop(htmlHeight);
		});
	});
</script>
<style type="text/css">
table{
	border-spacing: 10px;
}
.myMsg{
	background-color: #1565C0;	color:white;
	box-shadow: 3px 3px 3px black;
	font-size: 12pt;			text-shadow: none;	font-weight:800;
	padding: 10px;				border-radius: 10px;
}
.yourMsg{
	background-color: white;	color:#1565C0;
	box-shadow: 3px 3px 3px #1565C0;
	font-size: 12pt;			text-shadow: none;	font-weight:800;
	padding: 10px;				border-radius: 10px;
}
</style>
</head>
<body>
	<div data-role="page" id="loginPage">
		<div data-role="header" data-position="fixed">
			<h3>채팅</h3>
		</div>
		<div data-role="content">
			<img src="backpack.jpg" style="width:100%;">
			<input id="nickname" placeholder="대화명">
			<a href="#chatPage" data-role="button" data-transition="flow">로그인</a>
		</div>		
	</div>
	<!-- ------------------------------------------------------------- -->
	<div data-role="page" id="chatPage">
		<div data-role="header" data-position="fixed">
			<a href="#loginPage" data-icon="arrow-l" data-transition="turn">나가기</a>
			<h3>채팅</h3>
		</div>
		<div data-role="content">
			<table style="width:100%;"></table>
		</div>
		<div data-role="footer" data-position="fixed" data-theme="e">
			<input id="msg" placeholder="내용">
		</div>		
	</div>
</body>
</html>

